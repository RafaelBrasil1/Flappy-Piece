<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flappy Piece</title>

    <style>
        @font-face {
            font-family: 'VCR';
            src: url("/assets/VCR.ttf");
        }

        @font-face {
            font-family: "deadknight";
            src: url("/assets/Deadknight.otf");
        }

        body {
            margin: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        #canvas {
            height: 90%;

            border: 1px solid black;

        }
    </style>
</head>

<body>



    <canvas id="canvas" width="800" height="800">

        <h1>NÃ£o funciona</h1>
        <h1>AKAKAKKAKAKA</h1>

    </canvas>
</body>
<script>
    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext('2d');
    let anima;
    let velX = 0;
    let velY = 2;
    let x = 300;
    let y = 250;
    let rectW = 120;
    let rectH = 100;
    let Grav = 0.2;
    let background = new Image();
    let imagePlayer = new Image();
    let imageFruit = new Image();
    let imageBoss = new Image();
    let imageBoss2 = new Image();
    let flip = false;
    let gameover = false;
    imageFruit.src = "assets/gomu.png";
    imagePlayer.src = "assets/Flappy.gif";
    background.src = "assets/background1.png";
    imageBoss.src = "assets/luffy.png";
    imageBoss2.src = "assets/ace.png";
    let FrX = RandomInt(100, 700);
    let FrY = RandomInt(100, 700);
    let score = 0;
    let NxtFruit = 0;
    let whichBoss = 1
    let boss = false;
    let bossX = 900;
    let bossY = 200;
    let bossHeight = 500;
    let bossWidth = 500;
    let bossbar = 600;
    let aceTimer = 300;
    let attacking = true;
    let luffyataqSpeed = 5;
    let i = 1;
    let attacklist = [];
    let ata2 = ''
    let ataq1 = ''
    const Shoot = {
        direction: 0,
        x: 0,
        y: 1000,
        altura: 0,
        largura: 0,
        image: new Image(),


        desenha: function () {
            this.image.src = "assets/power.gif"

            ctx.save();
            if (this.direction < 0) {
                ctx.scale(-1, 1);
                ctx.drawImage(this.image, -this.x - this.largura, this.y, this.largura, this.altura);
            } else {
                ctx.drawImage(this.image, this.x, this.y, this.altura, this.largura)
            }
            ctx.restore();

        },




        move: function () {
            if(whichBoss == 1){
            if ((this.x >= 680 - 170 && this.y >= 290 - 170 && this.y <= 610 - 60) == false || bossX > 500) {
                this.x += this.direction;
                if (this.x - 200 >= canvas.width || this.x + 200 < 0) {

                    this.y = 1000;

                }
            } else {

                this.y = 1000;


                if (bossbar > 0) {

                bossbar -= 30;
                    

                } else {
                    bossbar = 0;
                }



            }
        }
        

        if(whichBoss == 2){
    // ctx.beginPath();
    // ctx.rect(this.x+40,this.y+72,100,62);
    // ctx.rect(580,235,220,170);
    // ctx.rect(650,405,150,150);
    // ctx.rect(600,570,120,100);
    // ctx.stroke();

        //


        
        
        if ((this.x+40 + 100 > 580 && this.y+72 + 62 > 235 && this.y+72 < 235 + 170) == false && (this.x+40 + 100 > 650 && this.y+72 < 405 + 150 && this.y+72 + 62 > 405) == false && (this.x+40 + 100 > 600 && this.x+40 < 600 + 120 && this.y+72 < 570 + 100 && this.y+72 + 62 > 570) == false || bossX > 500) {
                this.x += this.direction;
                if (this.x - 200 >= canvas.width || this.x + 200 < 0) {

                    this.y = 1000;

                }
            } else {

                this.y = 1000;


                if (bossbar > 0) {

                bossbar -= 25;
                    

                } else {
                    bossbar = 0;
                }
        }

        }
    }
}



    class LuffyAtaq {
        constructor(x, sentido) {
            this.image = new Image();
            this.image.src = "assets/luffy_atq.png";
            this.x = x;
            this.y = 0;
            this.largura = 200;
            this.altura = 0;
            this.sentido = sentido;
            this.ataqreturning = false;


        }



        desenha() {



            ctx.save();
            if (this.sentido == -1) {
                ctx.scale(1, -1);
                this.y = 0;
                ctx.drawImage(this.image, this.x, -this.y - this.altura, this.largura, this.altura);
            } else {
                this.y = 800;
                ctx.drawImage(this.image, this.x, this.y, this.largura, this.altura);
            }
            ctx.restore();

        }


        colide() {
            if (x + rectW <= this.x + this.largura && x + rectW - 75 >= this.x) {
                if (this.sentido == 1) {
                    if (y + rectH > 800 - (this.altura * -1)) {
                        gameover = true;
                    }
                } else if (this.sentido == -1) {
                    if (y + rectH - 30 < (this.altura)) {
                        gameover = true;
                    }
                }



            }
        }


    }

    class AceShoot {
        constructor() {
            this.imageVer = new Image();
            this.imageHor = new Image();
            this.imageHor.src = "assets/ace-attack1.png";
            this.imageVer.src = "assets/ace-attack1V.png";
            this.x = 0;
            this.y = 0;
            this.altura = 0;
            this.largura = 0;
            this.sentido = "";
            this.direction = "";
        }

        desenha() {
            ctx.save();
            if (this.direction == "V") {
                if (this.sentido == "-") {
                    this.altura = 200;
                    this.largura = 100;
                    ctx.scale(1, -1);
                    ctx.drawImage(this.imageVer, this.x, -this.y - this.altura, this.largura, this.altura);

                } else if (this.sentido == "+") {
                    this.altura = 200;
                    this.largura = 100;
                    ctx.drawImage(this.imageVer, this.x, this.y, this.largura, this.altura);
                }

            } else if (this.direction == "H") {
                if (this.sentido == "-") {
                    this.altura = 70;
                    this.largura = 200;
                    ctx.scale(-1, 1);
                    ctx.drawImage(this.imageHor, -this.x - this.largura, this.y, this.largura, this.altura);
                } else if (this.sentido == "+") {
                    this.altura = 200;
                    this.largura = 70;
                    ctx.drawImage(this.imageHor, this.x, this.y, this.altura, this.largura)
                }



            }
            ctx.restore();


        }


        move() {
            if (this.direction == "V") {
                if (this.sentido == "-") {
                    this.y += 4;


                } else if (this.sentido == "+") {
                    this.y -= 4;

                }

            } else if (this.direction == "H") {
                if (this.sentido == "-") {
                    this.x -= 4;

                } else if (this.sentido == "+") {
                    this.x += 4;

                }


            }


        }

        colide() {

            if (this.direction == "H") {

                // ctx.beginPath();
                // ctx.rect(50,50,700,700)
                // ctx.rect(this.x + 35, this.y +25, 140, 25);
                // ctx.stroke();

                if (x + 30 < this.x + 35 + 140 && x + 30 + 60 > this.x + 35 && y + 25 < this.y + 25 + 25 && y + 25 + 51 > this.y + 25) {
                    gameover = true;
                }



            } else if (this.direction == "V") {

                // ctx.beginPath();
                // ctx.rect(x+30,y+25,60,51)
                // ctx.rect(this.x + 35, this.y +55, 26, 120);
                // ctx.stroke();

                if (this.sentido == "+") {
                    if (x + 30 < this.x + 35 + 26 && x + 30 + 60 > this.x + 35 && y + 25 < this.y + 23 + 120 && y + 25 + 51 > this.y + 23) {
                        gameover = true;
                    }
                } else if (this.sentido == "-") {
                    if (x + 30 < this.x + 35 + 26 && x + 30 + 60 > this.x + 35 && y + 25 < this.y + 55 + 120 && y + 25 + 51 > this.y + 55) {
                        gameover = true;
                    }

                }

            }

        }
    }



    //random number function
    function RandomInt(min, max) {
        min = Math.ceil(min);
        max = Math.floor(max);
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }






    function draw() {
        

        //background
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(background, 0, 0, canvas.width, canvas.height);



        //draw fruit
        if (boss == false) {
            ctx.drawImage(imageFruit, FrX, FrY, 100, 100);


            // fruit colider
            if (x + (rectW - 50) > FrX && x < FrX + 50 && y + (rectH - 50) > FrY && y < FrY + 50) {


                score += 1;
                FrX = RandomInt(100, 700);
                FrY = RandomInt(100, 700);
                setInterval(20)
                NxtFruit = RandomInt(1, 3);
                switch (NxtFruit) {


                    case 1:
                        imageFruit.src = 'assets/gomu.png';
                        break;


                    case 2: imageFruit.src = 'assets/mera.png';
                        break;


                    case 3: imageFruit.src = 'assets/ope.png';
                        break;




                }
            }

        }




        //score


        ctx.font = "30px georgia";
        ctx.fillText("Score: " + score.toString(), 10, 30);



        //boss 1

        if (score == 5) {


            ctx.save();
            ctx.scale(-1, 1);
            ctx.drawImage(imageBoss, -bossX - bossWidth, bossY, bossWidth, bossHeight);
            ctx.restore();
            boss = true;

            //boss move


            if (bossX > 500) {
                bossX-= 3;
                whichBoss = 1;
            }

            //Boss text

            if (boss == true) {
                ctx.font = "70px VCR";
                ctx.fillText("LUFFY", 300, 80);


                // Boss Bar

                ctx.fillStyle = 'black';
                ctx.fillRect(110, 110, 600, 40);

                ctx.fillStyle = 'green';
                ctx.fillRect(110, 110, bossbar, 40);


                ctx.fillStyle = 'black';


                // Boss Ataqs

                if (bossX <= 500) {
                    if (attacking == true) {
                        attacking = false;
                        ataqUp = new LuffyAtaq(RandomInt(300, 500), 1);
                        ataqDown = new LuffyAtaq((ataqUp.x - 300), -1);









                    }


                    if (gameover == false) {
                        if (ataqUp.altura <= -1000) {
                            ataqUp.ataqreturning = true;
                        }

                        if (ataqDown.altura >= 1000) {
                            ataqDown.ataqreturning = true;
                        }


                        if (ataqUp.ataqreturning == false) {
                            ataqUp.altura -= luffyataqSpeed;

                        } else {
                            ataqUp.altura += luffyataqSpeed;
                        }

                    }

                    if (gameover == false) {
                        if (ataqDown.ataqreturning == false) {
                            ataqDown.altura += luffyataqSpeed;
                        } else {
                            ataqDown.altura -= luffyataqSpeed;
                        }
                    }



                    if (ataqUp.altura >= 0 && ataqDown.altura <= 0) {
                        attacking = true;
                        luffyataqSpeed += 1;
                    }

                    ataqUp.desenha();
                    ataqUp.colide();
                    ataqDown.desenha();
                    ataqDown.colide();
                }




            }

            //Boss death

            if (bossbar <= 0) {
                if (bossY <= 800) {
                    bossY += 10;
                }
                else {
                    bossX += 500;
                    score += 1;
                    boss = false;

                }


            }

        }

                //Boss 2

        if (score == 10) {

            ctx.save();
            ctx.scale(-1, 1);
            ctx.drawImage(imageBoss2, -bossX - bossWidth, bossY, bossWidth, bossHeight);
            ctx.restore();

            if(boss == false){
            bossbar = 600;
            bossY = 200;
            }

            boss = true;
            

            //boss move


            if (bossX > 500) {
                bossX -= 3;
                whichBoss = 2;
            }

            //Boss text

            if (boss == true) {
                ctx.font = "70px VCR";
                ctx.fillText("ACE", 350, 80);


                // Boss Bar

                ctx.fillStyle = 'black';
                ctx.fillRect(110, 110, 600, 40);

                ctx.fillStyle = 'green';
                ctx.fillRect(110, 110, bossbar, 40);


                ctx.fillStyle = 'black';


                // Boss Attack

                if (bossX <= 500) {


                    rand = 0;







                    if (aceTimer > 300) {

                        if (i != 10) {
                            attacklist[i] = new AceShoot;
                            attacklist[i].x = RandomInt(50, 700);
                            attacklist[i].y = RandomInt(50, 700);

                            rand = RandomInt(1, 4);

                            if (rand == 1) {
                                attacklist[i].direction = "V";
                                attacklist[i].sentido = "+";
                                attacklist[i].y = 850;
                            }
                            else if (rand == 2) {
                                attacklist[i].direction = "V";
                                attacklist[i].sentido = "-";
                                attacklist[i].y = -200;
                            }

                            else if (rand == 3) {
                                attacklist[i].direction = "H";
                                attacklist[i].sentido = "+";
                                attacklist[i].x = -150;
                            }

                            else if (rand == 4) {
                                attacklist[i].direction = "H";
                                attacklist[i].sentido = "-";
                                attacklist[i].x = 850;
                            }



                            i += 1;



                        } else {
                            aceTimer = 0;
                            i = 0;

                        }




                    } else {
                        aceTimer += 1;
                    }


                    for (z = 1; z < attacklist.length; z++) {
                        attacklist[z].desenha();
                        attacklist[z].move();
                        attacklist[z].colide();
                    }

                }


            }


            if (bossbar <= 0) {
                imageBoss2.src = "assets/ace-death.png";
                if (bossY <= 800) {
                    bossY += 10;
                }
                else {
                    bossX += 500;
                    score += 1;
                    boss = false;

                }


            }


        }







        // draw player


        ctx.save();
        if (flip) {
            ctx.scale(-1, 1);
            ctx.drawImage(imagePlayer, -x - rectW, y, rectW, rectH);
        } else {
            ctx.drawImage(imagePlayer, x, y, rectW, rectH);
        }
        ctx.restore();





        // colider player

        //walls

        if (x > canvas.width - (rectW - 30) || x < 0 - 30) {
            velX = 0;

            gameover = true;
        };

        if (y > canvas.height - (rectH - 30) || y < 0 - 30) {
            velY = 0;

            gameover = true;
        };
        //boss


        if (boss == true && bossX <= 500) {
            if (whichBoss == 1) {
                if (x >= 680 - rectW && y >= 290 - rectW && y <= 610) {

                    gameover = true;
                }
                if (x >= 630 - rectW && y >= 340 - rectW && y <= 400) {

                    gameover = true;
                }
            }

            if (whichBoss == 2){
                if(x+30+60 > 580 && y+25 + 51 > 235 && y+25 < 235 + 170){
                    gameover = true;
                }
                if(x+30+60 > 650 && y+25 < 405 + 150 && y+25 + 51 > 405){
                    gameover = true;

                }

                if(x+30+60 > 600 && x+30 < 600 +120 && y+25 < 570 + 100 && y+25 + 51 > 570){
                    gameover = true;
                }

            }
        }




        // ctx.beginPath();
        
        // ctx.rect(x+30,y+25,60,51);
        // ctx.stroke();
        










        //gameover True
        if (gameover == true) {
            ctx.font = "100px deadknight";
            imagePlayer.src = "assets/FlappyDeath.png";
            ctx.fillText("Game Over!", (canvas.width / 2) - 350, (canvas.height / 2) + 20);
            Grav = 0;
            velX = 0;
            velY = 0;
        }

        // vel updt

        velY += Grav;



        x += velX;
        y += velY;



        //hitbox 

        //boss 1

        // ctx.beginPath();
        // ctx.rect(650, 250, 150, 360);
        // ctx.rect(610,340, 60,60)
        // ctx.rect(610,580, 95,45)
        // ctx.stroke();



        // Shoot

        Shoot.desenha();
        Shoot.move();


        anima = requestAnimationFrame(draw);

    }



    //key events

    document.addEventListener('keydown', function (evento) {
        if ((evento.keyCode == 37 || evento.key == "a") && gameover == false) { // left arrow
            velX = -2;
            flip = true;
        }

        if ((evento.keyCode == 39 || evento.key == "d") && gameover == false) { // right arrow
            velX = 2;
            flip = false;
        }

        if ((evento.keyCode == 38 || evento.key == "w") && gameover == false) { //up arrow
            velY = -5;
        }

        if ((evento.key == "f") && gameover == false) { // f key

            if (Shoot.y > 999) {
                Shoot.x = x - 50;
                Shoot.y = y - 50;
                Shoot.altura = 200;
                Shoot.largura = 200;
                if (flip) {
                    Shoot.direction = -5;
                } else {
                    Shoot.direction = 5;
                }
            }






        }
    });

    draw()
</script>

</html>